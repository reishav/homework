import React, { useState } from 'react';

// Simple in-memory data storage
let userIdCounter = 1;
let postIdCounter = 1;
let commentIdCounter = 1;
const users = [];
const posts = [];
const comments = [];

function App() {
  // Auth states
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [currentUser, setCurrentUser] = useState(null);

  // Blog states
  const [newPostTitle, setNewPostTitle] = useState('');
  const [newPostContent, setNewPostContent] = useState('');
  const [commentText, setCommentText] = useState('');

  // Signup
  const signup = () => {
    if (!username || !password) return alert('Enter username and password');
    if (users.find(u => u.username === username)) return alert('Username taken');
    const user = { id: userIdCounter++, username, password };
    users.push(user);
    alert('User created!');
    setUsername('');
    setPassword('');
  };

  // Login
  const login = () => {
    const user = users.find(u => u.username === username && u.password === password);
    if (!user) return alert('Invalid credentials');
    setCurrentUser(user);
    setUsername('');
    setPassword('');
  };

  // Logout
  const logout = () => setCurrentUser(null);

  // Create post
  const addPost = () => {
    if (!newPostTitle || !newPostContent) return alert('Enter title and content');
    posts.push({
      id: postIdCounter++,
      title: newPostTitle,
      content: newPostContent,
      author: currentUser.username
    });
    setNewPostTitle('');
    setNewPostContent('');
  };

  // Add comment
  const addComment = (postId) => {
    if (!commentText) return alert('Enter comment');
    comments.push({
      id: commentIdCounter++,
      postId,
      text: commentText,
      author: currentUser.username
    });
    setCommentText('');
  };

  // Get comments for a post
  const getComments = (postId) => comments.filter(c => c.postId === postId);

  return (
    <div style={{ maxWidth: '700px', margin: 'auto', padding: '20px', fontFamily: 'Arial' }}>
      <h1>Blog Platform</h1>

      {!currentUser ? (
        <div style={{ marginBottom: '20px' }}>
          <h3>Signup / Login</h3>
          <input placeholder="Username" value={username} onChange={e => setUsername(e.target.value)} />
          <input placeholder="Password" type="password" value={password} onChange={e => setPassword(e.target.value)} />
          <button onClick={signup}>Sign Up</button>
          <button onClick={login}>Login</button>
        </div>
      ) : (
        <div style={{ marginBottom: '20px' }}>
          <h3>Welcome, {currentUser.username}</h3>
          <button onClick={logout}>Logout</button>
        </div>
      )}

      {currentUser && (
        <div style={{ marginBottom: '20px' }}>
          <h3>Create New Post</h3>
          <input placeholder="Title" value={newPostTitle} onChange={e => setNewPostTitle(e.target.value)} /><br />
          <textarea placeholder="Content" value={newPostContent} onChange={e => setNewPostContent(e.target.value)} /><br />
          <button onClick={addPost}>Add Post</button>
        </div>
      )}

      <h2>Posts</h2>
      {posts.length === 0 && <p>No posts yet.</p>}
      {posts.map(post => (
        <div key={post.id} style={{ border: '1px solid gray', padding: '10px', marginBottom: '15px' }}>
          <h3>{post.title}</h3>
          <p>{post.content}</p>
          <small>By: {post.author}</small>

          <div style={{ marginTop: '10px' }}>
            <h4>Comments:</h4>
            {getComments(post.id).map(c => (
              <p key={c.id}><b>{c.author}:</b> {c.text}</p>
            ))}
            {currentUser && (
              <div>
                <input placeholder="Add comment..." value={commentText} onChange={e => setCommentText(e.target.value)} />
                <button onClick={() => addComment(post.id)}>Comment</button>
              </div>
            )}
          </div>
        </div>
      ))}
    </div>
  );
}

export default App;
