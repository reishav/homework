// Run: node todo_app.js
// Then open http://localhost:3000 in your browser

const express = require('express');
const bodyParser = require('body-parser');
const app = express();
const PORT = 3000;

// Middleware
app.use(bodyParser.json());
app.use(express.static(__dirname)); // Serve HTML file

// In-memory todo list
let todos = [];
let idCounter = 1;

// API Endpoints

// Get all todos
app.get('/api/todos', (req, res) => {
  res.json(todos);
});

// Add a new todo
app.post('/api/todos', (req, res) => {
  const { text } = req.body;
  if (!text) return res.status(400).json({ error: 'Text required' });
  const newTodo = { id: idCounter++, text, completed: false };
  todos.push(newTodo);
  res.json(newTodo);
});

// Update a todo (mark as completed/uncompleted)
app.put('/api/todos/:id', (req, res) => {
  const { id } = req.params;
  const todo = todos.find(t => t.id == id);
  if (!todo) return res.status(404).json({ error: 'Todo not found' });
  todo.completed = !todo.completed;
  res.json(todo);
});

// Delete a todo
app.delete('/api/todos/:id', (req, res) => {
  const { id } = req.params;
  todos = todos.filter(t => t.id != id);
  res.json({ success: true });
});

// Serve frontend
app.get('/', (req, res) => {
  res.send(`
<!DOCTYPE html>
<html>
<head>
  <title>Todo App</title>
  <style>
    body { font-family: Arial; max-width: 600px; margin: auto; padding: 20px; }
    li.completed { text-decoration: line-through; color: gray; }
    button { margin-left: 10px; }
  </style>
</head>
<body>
  <h1>Todo List</h1>
  <input id="todoInput" type="text" placeholder="Add new todo" />
  <button onclick="addTodo()">Add</button>
  <ul id="todoList"></ul>

  <script>
    async function fetchTodos() {
      const res = await fetch('/api/todos');
      const todos = await res.json();
      const ul = document.getElementById('todoList');
      ul.innerHTML = '';
      todos.forEach(todo => {
        const li = document.createElement('li');
        li.textContent = todo.text;
        li.className = todo.completed ? 'completed' : '';
        li.onclick = () => toggleTodo(todo.id);
        const delBtn = document.createElement('button');
        delBtn.textContent = 'Delete';
        delBtn.onclick = (e) => { e.stopPropagation(); deleteTodo(todo.id); };
        li.appendChild(delBtn);
        ul.appendChild(li);
      });
    }

    async function addTodo() {
      const input = document.getElementById('todoInput');
      const text = input.value.trim();
      if (!text) return;
      await fetch('/api/todos', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text })
      });
      input.value = '';
      fetchTodos();
    }

    async function toggleTodo(id) {
      await fetch('/api/todos/' + id, { method: 'PUT' });
      fetchTodos();
    }

    async function deleteTodo(id) {
      await fetch('/api/todos/' + id, { method: 'DELETE' });
      fetchTodos();
    }

    fetchTodos();
  </script>
</body>
</html>
  `);
});

app.listen(PORT, () => console.log(`Todo app running at http://localhost:${PORT}`));
